<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Login with LINE</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 80px;
    }
  </style>
</head>
<body>

  <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE...</h3>

  <script>
    // ===============================
    // üîß CONFIG (‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 3 ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ)
    // ===============================
    const LIFF_ID = "2008686694-bLB6mwvm";

    const GAS_API_URL =
      "https://script.google.com/macros/s/AKfycbxaFvcFMjaP26p7Kp7wV1urfJCArD2in8_h0UirAh2S4R495qGiCQGKvkDdNYzkWncI/exec";

    const APPSHEET_URL =
      "https://www.appsheet.com/newshortcut/9e2e7172-8357-4bf4-82b8-da1d886b79d7";
    // ===============================

    (async () => {
      try {
        // ‡πÄ‡∏£‡∏¥‡πà‡∏° LIFF
        await liff.init({ liffId: LIFF_ID });

        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login ‚Üí ‡πÉ‡∏´‡πâ LINE login ‡∏Å‡πà‡∏≠‡∏ô
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ LINE
        const profile = await liff.getProfile();

        // üî• ‡∏™‡πà‡∏á lineUserId ‡πÑ‡∏õ GAS (‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CORS)
        const img = new Image();
        img.src =
          GAS_API_URL +
          "?lineUserId=" + encodeURIComponent(profile.userId) +
          "&t=" + Date.now();

        // ‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ AppSheet
        setTimeout(() => {
          window.location.replace(APPSHEET_URL);
        }, 500);

      } catch (err) {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô LIFF ID ‡∏ú‡∏¥‡∏î)
        document.body.innerHTML =
          "<p style='color:red'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>";
        console.error(err);
      }
    })();
  </script>

</body>
</html>
