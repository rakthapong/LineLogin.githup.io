<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
</head>

<body style="text-align:center;padding-top:100px;font-family:sans-serif">

<h2 id="title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

<script>
/* ===== CONFIG ===== */
const GAS_URL = "https://script.google.com/macros/s/AKfycbyzykQUd82rcmHfqWRkXl51-MyqkUJCCbU987_1OGUxWoelHE-e5v6z1rgbNzCjzC6Wmg/exec";
const APPSHEET_APP_ID = "1e844dd1-1d99-431f-909c-eb52684f5ccf";

/* menu ‚Üí AppSheet view */
const views = {
  payment: "payment_user",
  maintenance: "maintenance_user",
  service: "service_user",
  room: "room_user",
  roomstatus: "roomstatus_user"
};

const params = new URLSearchParams(location.search);
const menu = params.get("menu");
const loggedIn = localStorage.getItem("line_logged_in");

/* ===== LOGIN ===== */
function loginWithLine() {
  location.href =
    "https://access.line.me/oauth2/v2.1/authorize" +
    "?response_type=code" +
    "&client_id=2008686694" +
    "&redirect_uri=" + encodeURIComponent(GAS_URL) +
    "&scope=profile";
}

/* ===== OPEN APPSHEET ===== */
function openApp() {
  let url = `https://www.appsheet.com/start/${APPSHEET_APP_ID}`;
  if (menu && views[menu]) {
    url += `?view=${views[menu]}`;
  }
  location.href = url;
  setTimeout(() => window.open(url, "_blank"), 800);
}

/* ===== UI LOGIC ===== */
if (loggedIn === "yes") {
  document.write(`
    <button onclick="openApp()" style="font-size:20px;padding:14px 30px">
      üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  `);
} else {
  document.write(`
    <button onclick="loginWithLine()" style="font-size:20px;padding:14px 30px">
      üîê Login with LINE
    </button>
  `);
}
</script>

</body>
</html>
