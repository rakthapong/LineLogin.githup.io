<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login with LINE</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>

<h3>กำลังเข้าสู่ระบบด้วย LINE...</h3>

<script>
  const LIFF_ID = "2008686694-bLB6mwvm";
  const GAS_API_URL =
    "https://script.google.com/macros/s/AKfycby3DTgrNQsOHfvHVlzYM32ceAy1eh8DgSuxwjEDwV48VJSRmqSz1i-GRb9HUb-BwxzY/exec";
  const APPSHEET_URL =
    "https://www.appsheet.com/start/9e2e7172-8357-4bf4-82b8-da1d886b79d7";

  (async () => {
    try {
      await liff.init({ liffId: LIFF_ID });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();

      // ✅ ส่งข้อมูลแบบไม่ติด CORS
      const img = new Image();
      img.src =
        GAS_API_URL +
        "?lineUserId=" + encodeURIComponent(profile.userId) +
        "&t=" + Date.now();

      // รอแป๊บเดียวให้ GAS ทำงาน
      setTimeout(() => {
        window.location.href = APPSHEET_URL;
      }, 800);

    } catch (e) {
      document.body.innerHTML =
        "<p style='color:red'>เกิดข้อผิดพลาด</p>";
    }
  })();
</script>

</body>
</html>
