<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>LINE Login</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-store" />
</head>

<body style="font-family:sans-serif;text-align:center;padding-top:80px;">

<script>
  /******** CONFIG ********/
  const LINE_CHANNEL_ID = "2008686694";

  const GAS_URL =
    "https://script.google.com/macros/s/AKfycbxoR1TcVrI67y4MNrzIo5gHOo9S9T0v1IifG5OAFoDDXejerb4CSMOx9jm1tlFyMxznNw/exec";

  const APPSHEET_USER_URL =
    "https://www.appsheet.com/start/1e844dd1-1d99-431f-909c-eb52684f5ccf#view=user_home";
  /************************/

  const params = new URLSearchParams(window.location.search);

  function loginWithLine() {
    const authUrl =
      "https://access.line.me/oauth2/v2.1/authorize" +
      "?response_type=code" +
      "&client_id=" + LINE_CHANNEL_ID +
      "&redirect_uri=" + encodeURIComponent(GAS_URL) +
      "&state=login" +
      "&scope=profile";

    // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å user click ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    location.href = authUrl;
  }
</script>

<!-- ===== ‡∏Å‡∏£‡∏ì‡∏µ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ===== -->
<div id="success" style="display:none;">
  <h2>‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
  <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‚Ä¶</p>

  <p>
    <a id="openApp" target="_blank"
       style="font-size:18px;color:#06c;">
       üëâ ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û AppSheet
    </a>
  </p>
</div>

<!-- ===== ‡∏Å‡∏£‡∏ì‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login ===== -->
<div id="login">
  <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
  <button onclick="loginWithLine()"
    style="font-size:18px;padding:12px 24px;">
    üîê ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ LINE
  </button>
</div>

<script>
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å GAS (?success=1)
  if (params.get("success") === "1") {
    document.getElementById("login").style.display = "none";
    document.getElementById("success").style.display = "block";

    const link = document.getElementById("openApp");
    link.href = APPSHEET_USER_URL;

    // ‡πÄ‡∏õ‡∏¥‡∏î AppSheet ‡πÉ‡∏ô browser ‡∏à‡∏£‡∏¥‡∏á
    window.open(APPSHEET_USER_URL, "_blank");
  }
</script>

</body>
</html>
