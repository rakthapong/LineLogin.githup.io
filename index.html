<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="text-align:center;padding-top:120px;font-family:sans-serif">

<h2 id="title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
<p id="desc"></p>

<script>
/* ================= CONFIG ================= */
const LINE_CHANNEL_ID = "2008686694";
const GAS_URL = "https://script.google.com/macros/s/AKfycbzCRJqVOHc-TbMJyHFosaSGU2PR7NS_MIkPnECv_BP6_SHQ0HrHda5wmd-w3BTjLH-27Q/exec";
const APPSHEET_APP_ID = "1e844dd1-1d99-431f-909c-eb52684f5ccf";

/* menu ‚Üí AppSheet view */
const views = {
  payment: "payment_user",
  maintenance: "maintenance_user",
  service: "service_user",
  room: "room_user",
  roomstatus: "roomstatus_user"
};

/* ================= PARAM ================= */
const params = new URLSearchParams(location.search);
const menu = params.get("menu");
const loggedIn = localStorage.getItem("line_logged_in");

/* ================= FUNCTIONS ================= */
function loginWithLine() {
  location.href =
    "https://access.line.me/oauth2/v2.1/authorize" +
    "?response_type=code" +
    "&client_id=" + LINE_CHANNEL_ID +
    "&redirect_uri=" + encodeURIComponent(GAS_URL) +
    "&scope=profile";
}

function openAppSheet() {
  let url = `https://www.appsheet.com/start/${APPSHEET_APP_ID}`;
  if (menu && views[menu]) {
    url += `?view=${views[menu]}`;
  }
  location.href = url;
  setTimeout(() => window.open(url, "_blank"), 800);
}

/* ================= UI LOGIC ================= */
if (loggedIn === "yes") {
  document.getElementById("desc").innerText = "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
  openAppSheet(); // üî• ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
} else {
  document.getElementById("desc").innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE";
  document.write(`
    <button onclick="loginWithLine()" style="font-size:20px;padding:14px 30px">
      üîê Login with LINE
    </button>
  `);
}
</script>

</body>
</html>
