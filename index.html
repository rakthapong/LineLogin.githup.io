<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>LINE Login</title>

  <!-- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache -->
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
</head>

<body>
<script>
  /**************** CONFIG ****************/
  const LINE_CHANNEL_ID = "2008686694";

  // Google Apps Script Web App (doGet)
  const GAS_URL =
    "https://script.google.com/macros/s/AKfycbzYTh52hyo2I-7GHkjTxMQ7V2QbrjBonO1BpUk5S8RWAKNrpjGPFdo0O8u1tB0fyYvlQg/exec";

  // AppSheet Deep Link (‡πÄ‡∏õ‡∏¥‡∏î View user)
  const APPSHEET_USER_URL =
    "https://www.appsheet.com/start/1e844dd1-1d99-431f-909c-eb52684f5ccf#view=room_user";
  /****************************************/

  const params = new URLSearchParams(window.location.search);

  /************************************************
   * ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1 : LINE login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å GAS)
   ************************************************/
  if (params.get("success") === "1") {

    alert(
      "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ\n" +
      "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà"
    );

    /**
     * üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å
     * ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î AppSheet ‡πÉ‡∏ô top-level browser ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
     * ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ location.href
     */
    window.open(APPSHEET_USER_URL, "_blank");

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏≠‡∏Ç‡∏≤‡∏ß
    document.body.innerHTML = `
      <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
      <p>‡∏´‡∏≤‡∏Å‡πÅ‡∏≠‡∏û‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
      <p>
        <a href="${APPSHEET_USER_URL}" target="_blank"
           style="font-size:18px;">
          üëâ ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û AppSheet
        </a>
      </p>
    `;

  }

  /************************************************
   * ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2 : ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login ‚Üí ‡πÑ‡∏õ LINE Login
   ************************************************/
  else {

    const authUrl =
      "https://access.line.me/oauth2/v2.1/authorize" +
      "?response_type=code" +
      "&client_id=" + LINE_CHANNEL_ID +
      "&redirect_uri=" +_
